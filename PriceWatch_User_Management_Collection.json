{
	"info": {
		"_postman_id": "pricewatch-user-management",
		"name": "PriceWatch - User Management",
		"description": "Collection pour la gestion complète des utilisateurs (CRUD) - Exemples avec 6 sites e-commerce supportés (Amazon, Fnac, Darty, Cdiscount, Boulanger, E.Leclerc)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Create User - Alice",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 201) {",
							"    const response = pm.response.json();",
							"    pm.environment.set(\"aliceId\", response.id);",
							"    pm.environment.set(\"aliceEmail\", response.email);",
							"    console.log(\"✅ User Alice created with ID:\", response.id);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"alice@pricewatch.com\",\n  \"password\": \"SecurePass123!\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/auth/register",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"auth",
						"register"
					]
				},
				"description": "Créer l'utilisateur Alice"
			},
			"response": []
		},
		{
			"name": "2. Create User - Bob",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 201) {",
							"    const response = pm.response.json();",
							"    pm.environment.set(\"bobId\", response.id);",
							"    pm.environment.set(\"bobEmail\", response.email);",
							"    console.log(\"✅ User Bob created with ID:\", response.id);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"bob@pricewatch.com\",\n  \"password\": \"BobPassword456!\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/auth/register",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"auth",
						"register"
					]
				},
				"description": "Créer l'utilisateur Bob"
			},
			"response": []
		},
		{
			"name": "3. Create User - Charlie",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 201) {",
							"    const response = pm.response.json();",
							"    pm.environment.set(\"charlieId\", response.id);",
							"    pm.environment.set(\"charlieEmail\", response.email);",
							"    console.log(\"✅ User Charlie created with ID:\", response.id);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"charlie@pricewatch.com\",\n  \"password\": \"Charlie789Pass!\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/auth/register",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"auth",
						"register"
					]
				},
				"description": "Créer l'utilisateur Charlie"
			},
			"response": []
		},
		{
			"name": "4. Login - Alice",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 200) {",
							"    const response = pm.response.json();",
							"    pm.environment.set(\"aliceToken\", response.access_token);",
							"    pm.environment.set(\"currentToken\", response.access_token);",
							"    console.log(\"✅ Alice logged in, token saved\");",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"alice@pricewatch.com\",\n  \"password\": \"SecurePass123!\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/auth/login",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"auth",
						"login"
					]
				},
				"description": "Connexion d'Alice et sauvegarde du token"
			},
			"response": []
		},
		{
			"name": "5. Login - Bob",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 200) {",
							"    const response = pm.response.json();",
							"    pm.environment.set(\"bobToken\", response.access_token);",
							"    console.log(\"✅ Bob logged in, token saved\");",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"bob@pricewatch.com\",\n  \"password\": \"BobPassword456!\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/auth/login",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"auth",
						"login"
					]
				},
				"description": "Connexion de Bob et sauvegarde du token"
			},
			"response": []
		},
		{
			"name": "6. Login - Charlie",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 200) {",
							"    const response = pm.response.json();",
							"    pm.environment.set(\"charlieToken\", response.access_token);",
							"    console.log(\"✅ Charlie logged in, token saved\");",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"charlie@pricewatch.com\",\n  \"password\": \"Charlie789Pass!\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/auth/login",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"auth",
						"login"
					]
				},
				"description": "Connexion de Charlie et sauvegarde du token"
			},
			"response": []
		},
		{
			"name": "7. Get Alice Info",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{aliceToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/auth/me",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"auth",
						"me"
					]
				},
				"description": "Obtenir les informations d'Alice"
			},
			"response": []
		},
		{
			"name": "8. Get Bob Info",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{bobToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/auth/me",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"auth",
						"me"
					]
				},
				"description": "Obtenir les informations de Bob"
			},
			"response": []
		},
		{
			"name": "9. Get Charlie Info",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{charlieToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/auth/me",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"auth",
						"me"
					]
				},
				"description": "Obtenir les informations de Charlie"
			},
			"response": []
		},
		{
			"name": "10. Alice - Add Product (iPhone - Amazon)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 201) {",
							"    const response = pm.response.json();",
							"    pm.environment.set(\"aliceProduct1Id\", response.id);",
							"    console.log(\"✅ Product added for Alice:\", response.id);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{aliceToken}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"url\": \"https://www.amazon.fr/dp/B0CHXJ7QFT\",\n  \"target_price\": 799.00\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/products",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products"
					]
				},
				"description": "Alice ajoute un iPhone depuis Amazon (détection automatique du site)"
			},
			"response": []
		},
		{
			"name": "11. Bob - Add Product (Tablette - Cdiscount)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 201) {",
							"    const response = pm.response.json();",
							"    pm.environment.set(\"bobProduct1Id\", response.id);",
							"    console.log(\"✅ Product added for Bob:\", response.id);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{bobToken}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"url\": \"https://www.cdiscount.com/informatique/tablettes-tactiles-ebooks/apple-ipad-mini-6-wi-fi-64go-gris-sideral/f-10798-app0194252584576.html\",\n  \"target_price\": 499.00\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/products",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products"
					]
				},
				"description": "Bob ajoute une tablette depuis Cdiscount (nouveau site supporté)"
			},
			"response": []
		},
		{
			"name": "12. Charlie - Add Product (MacBook - Boulanger)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 201) {",
							"    const response = pm.response.json();",
							"    pm.environment.set(\"charlieProduct1Id\", response.id);",
							"    console.log(\"✅ Product added for Charlie:\", response.id);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{charlieToken}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"url\": \"https://www.boulanger.com/ref/1174942\",\n  \"target_price\": 1899.00\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/products",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products"
					]
				},
				"description": "Charlie ajoute un MacBook depuis Boulanger (nouveau site supporté)"
			},
			"response": []
		},
		{
			"name": "13. Alice - Get All Products",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{aliceToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/products",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products"
					]
				},
				"description": "Voir tous les produits d'Alice (inclut is_available et unavailable_since)"
			},
			"response": []
		},
		{
			"name": "14. Bob - Get All Products",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{bobToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/products",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products"
					]
				},
				"description": "Voir tous les produits de Bob"
			},
			"response": []
		},
		{
			"name": "15. Alice - Get Product History",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{aliceToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/products/{{aliceProduct1Id}}/history",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products",
						"{{aliceProduct1Id}}",
						"history"
					]
				},
				"description": "Alice consulte l'historique des prix de son produit"
			},
			"response": []
		},
		{
			"name": "16. Alice - Update Product Target Price",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{aliceToken}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"target_price\": 699.00,\n  \"name\": \"iPhone 15 Pro - Prix cible modifié\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/products/{{aliceProduct1Id}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products",
						"{{aliceProduct1Id}}"
					]
				},
				"description": "Alice modifie son prix cible pour l'iPhone"
			},
			"response": []
		},
		{
			"name": "17. Bob - Update Product Target Price",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{bobToken}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"target_price\": 449.00\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/products/{{bobProduct1Id}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products",
						"{{bobProduct1Id}}"
					]
				},
				"description": "Bob modifie son prix cible pour la tablette"
			},
			"response": []
		},
		{
			"name": "18. Alice - Check Product Price",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{aliceToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/products/{{aliceProduct1Id}}/check",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products",
						"{{aliceProduct1Id}}",
						"check"
					]
				},
				"description": "Alice vérifie manuellement le prix de son produit (avec retry logic et détection d'indisponibilité)"
			},
			"response": []
		},
		{
			"name": "19. Bob - Check Product Price",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{bobToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/products/{{bobProduct1Id}}/check",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products",
						"{{bobProduct1Id}}",
						"check"
					]
				},
				"description": "Bob vérifie manuellement le prix de son produit"
			},
			"response": []
		},
		{
			"name": "20. Alice - Delete Product",
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{aliceToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/products/{{aliceProduct1Id}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products",
						"{{aliceProduct1Id}}"
					]
				},
				"description": "Alice supprime son produit"
			},
			"response": []
		},
		{
			"name": "21. Bob - Delete Product",
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{bobToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/products/{{bobProduct1Id}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products",
						"{{bobProduct1Id}}"
					]
				},
				"description": "Bob supprime son produit"
			},
			"response": []
		},
		{
			"name": "22. [ERREUR] Bob tente d'accéder au produit d'Alice",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{bobToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/products/{{aliceProduct1Id}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products",
						"{{aliceProduct1Id}}"
					]
				},
				"description": "Test de sécurité : Bob ne devrait pas pouvoir accéder au produit d'Alice (doit retourner 404)"
			},
			"response": []
		},
		{
			"name": "23. [ERREUR] Accès sans token",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/api/v1/products",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"products"
					]
				},
				"description": "Test de sécurité : accès sans token (doit retourner 401 ou 403)"
			},
			"response": []
		},
		{
			"name": "24. [ERREUR] Login avec mauvais mot de passe",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"alice@pricewatch.com\",\n  \"password\": \"WrongPassword123\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/auth/login",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"auth",
						"login"
					]
				},
				"description": "Test de sécurité : login avec mauvais mot de passe (doit retourner 401)"
			},
			"response": []
		},
		{
			"name": "25. [ERREUR] Register email déjà existant",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"alice@pricewatch.com\",\n  \"password\": \"AnotherPassword456!\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/auth/register",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"auth",
						"register"
					]
				},
				"description": "Test de sécurité : création d'un utilisateur avec un email déjà existant (doit retourner 400)"
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8000",
			"type": "string"
		},
		{
			"key": "aliceToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "bobToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "charlieToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "aliceId",
			"value": "",
			"type": "string"
		},
		{
			"key": "bobId",
			"value": "",
			"type": "string"
		},
		{
			"key": "charlieId",
			"value": "",
			"type": "string"
		},
		{
			"key": "aliceEmail",
			"value": "",
			"type": "string"
		},
		{
			"key": "bobEmail",
			"value": "",
			"type": "string"
		},
		{
			"key": "charlieEmail",
			"value": "",
			"type": "string"
		},
		{
			"key": "aliceProduct1Id",
			"value": "",
			"type": "string"
		},
		{
			"key": "bobProduct1Id",
			"value": "",
			"type": "string"
		},
		{
			"key": "charlieProduct1Id",
			"value": "",
			"type": "string"
		},
		{
			"key": "currentToken",
			"value": "",
			"type": "string"
		}
	]
}
